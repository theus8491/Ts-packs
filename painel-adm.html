<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel ADM â€¢ TS Packs</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; }
  </style>
</head>

<body class="bg-neutral-950 text-white min-h-screen">

<header class="border-b border-white/10 bg-black/40 backdrop-blur">
  <div class="max-w-7xl mx-auto px-8 py-6 flex items-center justify-between">
    <h1 class="text-xl tracking-widest font-semibold">
      <span class="text-white">TS</span>
      <span class="text-red-600 font-bold">PACKS</span>
    </h1>

    <button id="logout"
      class="text-sm tracking-widest border border-white/20 px-4 py-2 rounded-lg hover:bg-red-600 transition">
      SAIR
    </button>
  </div>
</header>

<main class="max-w-7xl mx-auto px-8 py-12">

  <h2 class="text-3xl font-semibold mb-8">Painel Administrativo</h2>

  <div id="lista" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
    <p class="col-span-full text-center text-neutral-500 italic">Carregando modelos...</p>
  </div>

</main>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabase = createClient(
  'https://ezcdhydjxielfhjqgblk.supabase.co',
  'sb_publishable_hjJTkrZPGMgxAFDHPfzJ2A_DSKB1MEL'
)

/* ðŸ” proteÃ§Ã£o */
const { data: { session } } = await supabase.auth.getSession()
if (!session) location.href = 'login.html'

document.getElementById('logout').onclick = async () => {
  await supabase.auth.signOut()
  location.href = 'login.html'
}

/* ðŸ“¦ carregar modelos */
async function carregar() {
  const lista = document.getElementById('lista')

  const { data } = await supabase
    .from('modelos')
    .select('*')
    .order('id', { ascending: false })

  if (!data || data.length === 0) {
    lista.innerHTML = '<p class="col-span-full text-center text-neutral-500">Nenhuma modelo</p>'
    return
  }

  lista.innerHTML = data.map(m => `
    <div class="bg-neutral-900 border border-white/10 rounded-2xl overflow-hidden">

      <img src="${m.foto_url}" class="w-full h-64 object-cover">

      <div class="p-5">
        <h3 class="font-semibold">${m.nome}</h3>
        <p class="text-xs text-neutral-400 mb-4">
          ${m.aprovado ? 'PUBLICADA NO INDEX' : 'NÃƒO PUBLICADA'}
        </p>

        <div class="grid grid-cols-2 gap-2">
          ${
            m.aprovado
              ? `<button onclick="despublicar('${m.id}')" class="py-2 text-xs rounded bg-yellow-600 hover:bg-yellow-700">
                   REMOVER DO INDEX
                 </button>`
              : `<button onclick="aprovar('${m.id}')" class="py-2 text-xs rounded bg-green-600 hover:bg-green-700">
                   PUBLICAR NO INDEX
                 </button>`
          }

          <button onclick="removerTotal('${m.id}')" 
            class="py-2 text-xs rounded bg-red-600 hover:bg-red-700 col-span-2">
            REMOVER TOTAL (APAGA FOTO)
          </button>
        </div>
      </div>
    </div>
  `).join('')
}

carregar()

/* âœ… publicar */
window.aprovar = async (id) => {
  await supabase.from('modelos').update({ aprovado: true }).eq('id', id)
  carregar()
}

/* ðŸš« remover do index */
window.despublicar = async (id) => {
  await supabase.from('modelos').update({ aprovado: false }).eq('id', id)
  carregar()
}

/* ðŸ—‘ï¸ remover total */
window.removerTotal = async (id) => {
  if (!confirm('Isso vai apagar a modelo e a foto. Continuar?')) return

  const { data } = await supabase
    .from('modelos')
    .select('foto_path')
    .eq('id', id)
    .single()

  if (data?.foto_path) {
    await supabase.storage.from('fotos').remove([data.foto_path])
  }

  await supabase.from('modelos').delete().eq('id', id)
  carregar()
}
</script>

</body>
</html>
