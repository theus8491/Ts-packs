<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro Modelo - TS PACKS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background-color: #0a0a0a; color: white; overflow-x: hidden; }
    .glass { background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); }
    input, textarea, select { background: rgba(0,0,0,0.4) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; transition: 0.3s; }
    input:focus, select:focus { border-color: #dc2626 !important; box-shadow: 0 0 10px rgba(220, 38, 38, 0.2); }
    .upload-box { border: 2px dashed rgba(255,255,255,0.1); transition: 0.3s; cursor: pointer; }
    .upload-box:hover { border-color: #dc2626; background: rgba(220, 38, 38, 0.05); }
    
    .vip-card { transition: 0.3s; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); }
    #vip:checked + .vip-label { border-color: #dc2626; background: rgba(220, 38, 38, 0.1); }
    #vip:checked + .vip-label .check-circle { background: #dc2626; border-color: #dc2626; }

    #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
    .toast { padding: 16px 24px; border-radius: 12px; font-weight: 600; font-size: 14px; margin-bottom: 10px; animation: slideIn 0.5s ease forwards; display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .toast-success { background: #059669; color: white; border-left: 5px solid #10b981; }
    .toast-error { background: #dc2626; color: white; border-left: 5px solid #f87171; }
    
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .loading-spinner { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #dc2626; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="min-h-screen py-12 px-6 flex justify-center items-center">

  <div id="toast-container"></div>

  <div class="glass w-full max-w-2xl p-8 md:p-12 rounded-3xl shadow-2xl">
    <div class="text-center mb-10">
        <h1 class="text-3xl font-black italic uppercase tracking-tighter">FAÇA PARTE DA <span class="text-red-600">TS</span></h1>
        <p class="text-neutral-500 text-[10px] font-bold uppercase tracking-[0.3em] mt-3">Preencha seus dados para análise</p>
    </div>

    <form id="regForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="md:col-span-2 border-b border-white/5 pb-2">
          <h2 class="text-red-600 text-[11px] font-black uppercase tracking-widest">Acesso ao Painel</h2>
      </div>
      <div>
        <label class="text-[9px] font-black uppercase text-neutral-400 block mb-2">E-mail</label>
        <input type="email" id="email" required class="w-full rounded-xl p-4 text-sm outline-none" placeholder="exemplo@gmail.com">
      </div>
      <div>
        <label class="text-[9px] font-black uppercase text-neutral-400 block mb-2">Senha</label>
        <input type="password" id="password" required class="w-full rounded-xl p-4 text-sm outline-none" placeholder="Mínimo 6 dígitos">
      </div>

      <div class="md:col-span-2 border-b border-white/5 pb-2 mt-4">
          <h2 class="text-red-600 text-[11px] font-black uppercase tracking-widest">Perfil Público</h2>
      </div>
      <div>
        <label class="text-[9px] font-black uppercase text-neutral-400 block mb-2">Nome Artístico</label>
        <input type="text" id="nome" required class="w-full rounded-xl p-4 text-sm outline-none">
      </div>
      <div>
        <label class="text-[9px] font-black uppercase text-neutral-400 block mb-2">WhatsApp</label>
        <input type="text" id="whatsapp" required class="w-full rounded-xl p-4 text-sm outline-none" placeholder="719XXXXXXXX">
      </div>

      <div class="md:col-span-2 bg-white/5 p-4 rounded-2xl border border-white/10">
          <h3 class="text-white text-[10px] font-black uppercase tracking-widest mb-4">Configuração da sua Assinatura</h3>
          <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-[9px] font-black uppercase text-neutral-400 block mb-2">Valor Cobrado (R$)</label>
                <input type="number" id="valor_assinatura" required class="w-full rounded-xl p-4 text-sm outline-none" placeholder="Ex: 30.00">
              </div>
              <div>
                <label class="text-[9px] font-black uppercase text-neutral-400 block mb-2">Tempo de Acesso</label>
                <select id="tempo_assinatura" class="w-full rounded-xl p-4 text-sm outline-none">
                    <option value="7">7 Dias</option>
                    <option value="15">15 Dias</option>
                    <option value="30" selected>30 Dias</option>
                    <option value="90">90 Dias</option>
                    <option value="365">Vitalício</option>
                </select>
              </div>
          </div>
      </div>

      <div class="md:col-span-2">
        <label class="text-[9px] font-black uppercase text-neutral-400 block mb-2">Foto de Perfil</label>
        <label for="foto_file" class="upload-box w-full h-40 rounded-xl flex flex-col items-center justify-center gap-2">
            <span id="file-name" class="text-xs text-neutral-500 font-bold uppercase tracking-widest">Selecionar Imagem</span>
        </label>
        <input type="file" id="foto_file" accept="image/*" required class="hidden">
      </div>

      <div class="md:col-span-2">
        <label class="text-[9px] font-black uppercase text-neutral-400 block mb-2">Descrição</label>
        <textarea id="descricao" rows="2" class="w-full rounded-xl p-4 text-sm outline-none" placeholder="Conte mais sobre seu conteúdo..."></textarea>
      </div>

      <div class="md:col-span-2">
          <input type="checkbox" id="vip" class="hidden">
          <label for="vip" class="vip-label vip-card w-full p-5 rounded-2xl flex items-center justify-between glass border border-white/10 transition-all">
              <div class="flex items-center gap-4">
                  <div class="check-circle w-6 h-6 rounded-full border-2 border-white/20 flex items-center justify-center">
                      <div class="w-2 h-2 bg-white rounded-full opacity-0"></div>
                  </div>
                  <div>
                      <h3 class="text-xs font-black uppercase text-white">Destaque VIP</h3>
                      <p class="text-[9px] text-neutral-500 uppercase">Aparecer no topo do site</p>
                  </div>
              </div>
              <div class="text-right">
                  <span class="text-red-600 font-black text-sm uppercase">R$ 20,00</span>
              </div>
          </label>
      </div>

      <button type="submit" id="btnReg" class="md:col-span-2 bg-red-600 hover:bg-red-700 text-white font-black py-5 rounded-2xl transition-all uppercase tracking-[0.2em] text-xs shadow-lg shadow-red-600/20 mt-4 flex justify-center items-center gap-3">
        Finalizar meu Cadastro
      </button>
    </form>
  </div>

  <script>
    const _supabase = supabase.createClient('https://ezcdhydjxielfhjqgblk.supabase.co', 'sb_publishable__ACUqgBDxQZIqCzY13LyKQ__IgrksjW');

    function showToast(message, type) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = type === 'success' ? `<span>✓</span> ${message}` : `<span>✕</span> ${message}`;
        container.appendChild(toast);
        setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 4000);
    }

    document.getElementById('foto_file').addEventListener('change', function() {
        if(this.files[0]) document.getElementById('file-name').innerText = "✓ " + this.files[0].name;
    });

    document.getElementById('regForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('btnReg');
      const file = document.getElementById('foto_file').files[0];
      const isVip = document.getElementById('vip').checked;

      btn.innerHTML = '<div class="loading-spinner"></div> PROCESSANDO...';
      btn.disabled = true;

      try {
        // 1. Criar Auth
        const { data: auth, error: authErr } = await _supabase.auth.signUp({ 
            email: document.getElementById('email').value, 
            password: document.getElementById('password').value 
        });
        if (authErr) throw authErr;

        // 2. Upload Foto
        const fileName = `${auth.user.id}-${Date.now()}.${file.name.split('.').pop()}`;
        const { error: upErr } = await _supabase.storage.from('fotos-modelos').upload(fileName, file);
        if (upErr) throw upErr;

        // 3. Link Público
        const { data: urlData } = _supabase.storage.from('fotos-modelos').getPublicUrl(fileName);

        // 4. Salvar Dados (Incluindo os novos campos de assinatura)
        const { error: dbErr } = await _supabase.from('modelos').insert([{
            id: auth.user.id,
            nome: document.getElementById('nome').value,
            whatsapp: document.getElementById('whatsapp').value,
            foto_url: urlData.publicUrl,
            descricao: document.getElementById('descricao').value,
            valor_assinatura: parseFloat(document.getElementById('valor_assinatura').value),
            tempo_assinatura: parseInt(document.getElementById('tempo_assinatura').value),
            aprovado: false,
            vip: isVip
        }]);

        if (dbErr) throw dbErr;

        showToast("Cadastro realizado com sucesso!", "success");
        setTimeout(() => { window.location.href = 'login-modelo.html'; }, 3000);

      } catch (err) {
        showToast(err.message, "error");
        btn.innerHTML = "Finalizar meu Cadastro";
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>